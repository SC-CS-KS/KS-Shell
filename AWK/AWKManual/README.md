# 01.AWK 三种方式调用awk 

三种方式调用awk 
01.awk [opion] 'awk_script' input_file1 [input_file2 ...] 
awk的常用选项option有: 
① -F fs :         使用fs作为输入记录的字段分隔符，如果省略该选项，wak使用环境变量IFS的值。 
② -f filename :   从文件filename中读取awk_script。
③ -v var=value :  为awk_script设置变量。 

02.将awk_script放入脚本文件，并以 #!/bin/awk -f 作为首行，给予该脚本可执行权限，然后在shell下通过键入该脚本的脚本名调用之。 

03.将所有的awk_script插入一个单独脚本文件，然后调用: awk -f awk脚本文件 input_file(s)。 

# 02.AWK 选项

-F fs or --field-separator fs
指定输入文件折分隔符，fs是一个字符串或者是一个正则表达式
如:   -F :
----------------------------------------------------------------------------
-v var=value or --asign var=value
赋值一个用户定义变量。
----------------------------------------------------------------------------
-f scripfile or --file scriptfile
从脚本文件中读取awk命令。
----------------------------------------------------------------------------
-mf nnn and -mr nnn
对nnn值设置内在限制，-mf选项限制分配给nnn的最大块数目；-mr选项限制记录的最大数目。
这两个功能是Bell实验室版awk的扩展功能，在标准awk中不适用。
----------------------------------------------------------------------------
-W compact or --compat, -W traditional or --traditional
在兼容模式下运行awk。所以gawk的行为和标准的awk完全一样，所有的awk扩展都被忽略。
----------------------------------------------------------------------------
-W copyleft or --copyleft, -W copyright or --copyright
打印简短的版权信息。
----------------------------------------------------------------------------
-W help or --help, -W usage or --usage
打印全部awk选项和每个选项的简短说明。
----------------------------------------------------------------------------
-W lint or --lint
打印不能向传统unix平台移植的结构的警告。
----------------------------------------------------------------------------
-W lint-old or --lint-old
打印关于不能向传统unix平台移植的结构的警告。
----------------------------------------------------------------------------
-W posix
打开兼容模式。
但有以下限制，不识别：\x、函数关键字、func、换码序列以及当fs是一个空格时，将新行作为一个域分隔符；
操作符**和**=不能代替^和^=；fflush无效。
----------------------------------------------------------------------------
-W re-interval or --re-inerval
允许间隔正则表达式的使用，参考(grep中的Posix字符类)，如括号表达式[[:alpha:]]。
----------------------------------------------------------------------------
-W source program-text or --source program-text
使用program-text作为源代码，可与-f命令混用。
----------------------------------------------------------------------------
-W version or --version
打印bug报告信息的版本。

# 10.AWK 域分隔符

问题：
abstime=2008-01-29 15:00:00||dt=0||ru=ht
如果用“|”作为分隔符，是可以的： awk -F"|" '{print $3}' tmp.log，但是用“||”作为分隔符失败。

解决：
-F'[|]+'
或
awk -F'\\|\\|'

解析：
很遗憾，awk对正则的支持相当有限，但这不是没有原因的。

awk的语法力图模仿C，所以字符串的转义序列是照搬C的，如\a表示蜂鸣，\t表示水平制表，\n表示换行，\b表示退格， \f表示换页等等。

除开那些C风格的转移序列之外的转义序列，如\q, \|之类，大多数awk版本处理时会简单地把反斜杠\丢弃，
所以你写\q，awk会当作普通字符q，写\|，awk会当作普通字符|。
但gawk这样做时会提示用户，这就是awk为什么会发出类似escape sequence `\|' treated as plain `|'这样的警告的原因了。
还有一些版本的awk会认可这些非C风格的转移序列，据我所知debian缺省安装的的mawk就是如此。

因此正则表达式中经常用到的转义方式都需要用两个反斜杠，写成有点怪异的样子。
例如你上面提到的\\|，还有gawk中gensub中才能使用的反向引用必须写成\\1, \\2而不是简单的\1, \2。

总之，在awk中用正则有时会比较头疼，如果你的正则比较高级点，建议改用sed，尤其建议改用perl。

这大概就是所谓历史的负担吧，保持兼容性的代价。
其实GNU sed已经支持大多数的C风格转义序列。
例外的一个是\b，在C风格里代表退格，但在正则里代表单词边界，gsed中用后者的含义；
另一个是\nnn，在C风格里代表一个字符，它的acii码是8进制数字nnn，但正则里\1～\9用作向前引用，
表示正则里第1～第9个小括号内匹配的内容，两个有冲突。所以Gsed用\onnn来代替。

我的意见gawk应该向Gsed学习，上面两个冲突我想也不难解决。
其实gawk里已经使用\y代替\b作为单词边界；至于八进制的转义不妨也向gsed看齐，用\onnn，把\1~\9用作向前引用。
如果解决了转移序列的问题，awk对正则的支持大大改进应该就顺理成章了。

做一点补充说明：
在正则表达式常量（用两个/括起来的）中的转义可以使用一个\，因为这时的上下文很明确：正则环境。
例如：
$ echo '|' |awk '/\|/'
|
其它场合，一般都是字符串的上下文，都要使用两个\。

# 51.AWK 使用

http://www.myfreelinux.com/?p=230

# 80.The GNU Awk User’s Guide

https://www.gnu.org/software/gawk/manual/html_node/index.html

