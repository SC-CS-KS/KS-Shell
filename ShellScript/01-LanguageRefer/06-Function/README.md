# 06.Shell Function

## 01.函数的定义和基本知识

函数的定义和基本知识
Shell函数是一串命令的集合。函数可以把大的命令集合分解成若干较小的任务。
编程人员可以基于函数进一步的构造更复杂的Shell 程序，而不需要重复编写相同的代码。

函数在使用之前必须被定义，可以放在脚本的起始处，或者放在另一个文件中，以点号(.)来取用(source)它们。
下面给出了Linux Shell中函数的基本形式
               function_name()
               {
                    command1
                    command2
                    …
                    commandN
                }

对函数结构进行解释：
在编写脚本时要注意函数应该唯一，如果不唯一，后面定义会覆盖前面。
在函数名前可以加上关键字function，但加上和省略关键字function对脚本的最终执行不产生任何影响。
函数体中的命令集合必须含有至少一条命令，即函数不允许空命令，这一点和C语言不同。
函数之间可通过参数、函数返回值交互，函数在脚本中出现的次序可以是任意的，但是必须按照脚本中的调用次序执行这些函数。
----------------------------------------------------------------------------------------------------------------------

## 02.向函数传递参数

向函数传递参数
在bash Shell编程中，向函数传递的参数仍然是以位置参数的方式来传递的，
而不能传递数组等其它形式变量，这与C语言或Java语言中的函数传递是不同的。
$@、$#、$*也是函数的参数

当调用函数时，父脚本的参数则临时被函数参数覆盖（shadowed）。
$0依旧是父脚本的名称。
当函数执行完时，原来的命令行参数会恢复。
-----------------------------------------------------------------------------------------------------
#function4.sh
#!/bin/bash

half()
{
     let "n = $1"
     let "n = n/2"
     echo "In function half() n is $n"
}

let "m = $1"
echo "Before the function half() is called, m is $m"
half $m
echo "After the function half() is called, m is $m"
-----------------------------------------------------------------------------------------------------

## 03.函数返回值

函数返回值
有时需要脚本执行完成后返回特定的值来完成脚本的后继操作，这些特定的值就是函数返回值。

在Linux Shell编程中，函数通过return返回其退出状态，0表示无错误，1表示有错误。
如果不用return显式的返回值，则函数默认返回最后一条命令的执行结果，保存在$?中。
-----------------------------------------------------------------------------------------------------
#function7.sh
#!/bin/bash

show_week()
{
     echo -n "What you input is: "
     echo "$1"

    case $1 in 
    0)
        echo "Today is Sunday. "
        return 0;;
    1)
        echo "Today is Monday. "
        return 0;;
    2)
        echo "Today is Tuesday. "
        return 0;;
    3)
        echo "Today is Wednesday. "
        return 0;;
    4)
        echo "Today is Thursday. "
        return 0;;
    5)
        echo "Today is Friday. "
        return 0;;
    6)
        echo "Today is Saturday. "
        return 0;;
    *)
        return 1;;
    esac
}

if show_week "$1"
then
    echo "What you input is right! "
else 
    echo "What you input is wrong! "
fi
exit 0
-----------------------------------------------------------------------------------------------------

### return/echo 返回值的区别 

Shell函数返回值，常用的两种方式：return，echo
1） return 语句
shell函数的返回值，可以和其他语言的返回值一样，通过return语句返回。
示例：
#!/bin/sh  f
function test()  {
{   
    echo "arg1 = $1"   
    if [ $1 = "1" ] ;then   
        return 1   
    else   
        return 0   
    fi  }
}   
  e
echo   e
echo "test 1"  t
test 1  e
echo $?         # print return result   
  e
echo   e
echo "test 0"  t
test 0  e
echo $?         # print return result   
  e
echo   e
echo "test 2"  t
test 2  e
echo $?         # print return result  

输出结果为：
test 1
arg1 = 1
1
test 0
arg1 = 0
0
test 2
arg1 = 2
0
先定义了一个函数test，根据它输入的参数是否为1来return 1或者return 0。
获取函数的返回值通过调用函数，或者最后执行的值获得。
另外，可以直接用函数的返回值用作if的判断。
注意：return只能用来返回整数值，且和c的区别是返回0为正确，其他的值为错误。
 
2） echo 返回值
其实在shell中，函数的返回值有一个非常安全的返回方式，即通过输出到标准输出返回。
因为子进程会继承父进程的标准输出，因此，子进程的输出也就直接反应到父进程。
示例：
#!/bin/sh  f
function test()  {
{   
    echo "arg1 = $1"   
    if [ $1 = "1" ] ;then   
        echo "1"   
    else   
        echo "0"   
    fi  }
}   
  e
echo   e
echo "test 1"  t
test 1  

  e
echo   e
echo "test 0"  t
test 0  

  e
echo   e
echo "test 2"  t
test 2  
 
结果：
test 1
arg1 = 1
1
test 0
arg1 = 0
0
test 2
arg1 = 2
0
 
怎么？有没有搞错，这两个函数几乎没什么区别，对，它几乎就是return和echo不一样。
但是有一点一定要注意，不能向标准输出一些不是结果的东西（也就是说，不能随便echo一些不需要的信息），比如调试信息。
这些信息可以重定向到一个文件中解决。
特别要注意的是，脚本中用到其它类似grep这样的命令的时候，一定要记得1>/dev/null 2>&1来空这些输出信息输出到空设备，避免这些命令的输出。

## 04.函数调用

函数相互调用
在Linux Shell编程中，函数之间可以相互调用，调用时会停止当前运行的函数转去运行被调用的函数，直到调用的函数运行完，再返回当前函数继续运行。
-----------------------------------------------------------------------------------------------------
一个函数调用多个函数
在Linux Shell编程中允许一个函数调用多个函数，在该函数调用其他函数时同样需要按照调用的顺序来执行调用的函数。
-----------------------------------------------------------------------------------------------------

## 05.局部变量和全局变量

局部变量和全局变量
在Linux Shell编程中，可以通过local关键字在Shell函数中声明局部变量，局部变量将局限在函数范围内。
此外，函数也可调用函数外的全局变量，如果一个局部变量和一个全局变量名字相同，则在函数中局部变量将会覆盖掉全局变量。

如果不是用local声明，函数和父脚本是共享变量的。
要注意在函数中不要修改父脚本中不期望被修改的变量。
-----------------------------------------------------------------------------------------------------
local在Bash中是一个内建命令，只能用在函数中，但在《shell脚本学习指南》这么书中没有被提到，这个命令可能存在可移植性问题。
-----------------------------------------------------------------------------------------------------

## 06.函数递归

函数递归
Linux Shell中可以递归调用函数，即函数可以直接或间接调用其自身。
在递归调用中，主调函数又是被调函数。执行递归函数将反复调用其自身，每调用一次就进入新的一层。

                             #!/bin/bash
 
                              #递归调用函数
                              foo()
                             {
                                    read y
                                    foo $y
                                    echo "$y"
                              }
 
                              #调用函数
                              foo
                              exit 0

使用局部变量进行递归一般是针对数值运行来使用的。
阶乘运算是一个使用局部变量的递归调用过程，实现了n! 的运算，其可以通过下面的公式表示：
                    n!=1           (n=0)
                    n!=n*(n-1)!    (n>=1)

按照该公式可实现对阶乘的运算，由于该阶乘运算中存在终止条件“0!=1”，所以可以使用函数递归来实现该运算。

#function13.sh
#!/bin/bash

fact ()
{
    local num=$1
    
    if [ "$num" -eq 0 ]
    then
        factorial=1
    else
        let "decnum=num-1"

        fact $decnum

        let "factorial=$num * $?"
    fi
    return $factorial
}

fact $1
echo "Factorial of $1 is $?"

exit 0
-----------------------------------------------------------------------------------------------------
